!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).ShelfPack=e()}(this,(function(){"use strict";"function"==typeof SuppressedError&&SuppressedError;var t=function(t,e,i,s,h,r,n,o){void 0===r&&(r=s),void 0===n&&(n=h),void 0===o&&(o=0),this.id=t,this.x=e,this.y=i,this.w=s,this.h=h,this.maxw=r,this.maxh=n,this.refcount=o},e=function(){function e(t,e,i,s){void 0===s&&(s=0),this.y=t,this.w=e,this.h=i,this.x=s,this.free=e}return e.prototype.alloc=function(e,i,s){if(e>this.free||i>this.h)return null;var h=this.x;return this.x+=e,this.free-=e,new t(s,h,this.y,e,i,e,this.h)},e.prototype.resize=function(t){this.free+=t-this.w,this.w=t},e}(),i=function(){function i(t,e,i){void 0===t&&(t=64),void 0===e&&(e=64);var s=null!=i?i:{};this.autoResize=!!s.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0,this.w=t,this.h=e}return i.prototype.pack=function(t,e){void 0===e&&(e={});for(var i=function(t,e,i){if(i||2===arguments.length)for(var s,h=0,r=e.length;h<r;h++)!s&&h in e||(s||(s=Array.prototype.slice.call(e,0,h)),s[h]=e[h]);return t.concat(s||Array.prototype.slice.call(e))}([],t,!0),s=[],h=0;h<i.length;h++){var r=i[h].w||i[h].w,n=i[h].h||i[h].h,o=i[h].id;if("number"==typeof r&&"number"==typeof n){var f=this.packOne(r,n,o);if(!f)continue;if(e.inPlace){if("x"in i[h]&&"y"in i[h]){var a=t[h];a.x=f.x,a.y=f.y,a.id=f.id}s.push(f)}}}return this.shrink(),s},i.prototype.packOne=function(t,i,s){var h,r,n,o,f,a={freebin:-1,shelf:-1,waste:1/0},l=0;if("string"==typeof s||"number"==typeof s){if(h=this.getBin(s))return this.ref(h),h;f=s}else f=++this.maxId;for(o=0;o<this.freebins.length;o++){if(i===(h=this.freebins[o]).maxh&&t===h.maxw)return this.allocFreebin(o,t,i,f);i>h.maxh||t>h.maxw||i<=h.maxh&&t<=h.maxw&&(n=h.maxw*h.maxh-t*i)<a.waste&&(a.waste=n,a.freebin=o)}for(o=0;o<this.shelves.length;o++)if(l+=(r=this.shelves[o]).h,!(t>r.free)){if(i===r.h)return this.allocShelf(o,t,i,f);i>r.h||i<r.h&&(n=(r.h-i)*t)<a.waste&&(a.freebin=-1,a.waste=n,a.shelf=o)}if(-1!==a.freebin)return this.allocFreebin(a.freebin,t,i,f);if(-1!==a.shelf)return this.allocShelf(a.shelf,t,i,f);if(i<=this.h-l&&t<=this.w)return r=new e(l,this.w,i),this.allocShelf(this.shelves.push(r)-1,t,i,f);if(this.autoResize){var u,c,p=void 0,v=void 0;return u=p=this.h,((c=v=this.w)<=u||t>c)&&(v=2*Math.max(t,c)),(u<c||i>u)&&(p=2*Math.max(i,u)),this.resize(v,p),this.packOne(t,i,f)}return null},i.prototype.allocFreebin=function(e,i,s,h){var r=this.freebins.splice(e,1)[0],n=new t(h,r.x,r.y,i,s,r.maxw,r.maxh,0);return this.bins[h]=n,this.ref(n),n},i.prototype.allocShelf=function(t,e,i,s){var h=this.shelves[t].alloc(e,i,s);if(null===h)throw new Error("Failed to allocate bin on shelf.");return this.bins[s]=h,this.ref(h),h},i.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,e=0,i=0;i<this.shelves.length;i++){var s=this.shelves[i];e+=s.h,t=Math.max(s.w-s.free,t)}this.resize(t,e)}},i.prototype.getBin=function(t){return this.bins[t]},i.prototype.ref=function(t){return 1==++t.refcount&&(this.stats[t.h]=1+(0|this.stats[t.h])),t.refcount},i.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},i.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},i.prototype.resize=function(t,e){this.w=t,this.h=e;for(var i=0;i<this.shelves.length;i++)this.shelves[i].resize(t);return!0},i}();return i}));
//# sourceMappingURL=shelf-pack.min.js.map
