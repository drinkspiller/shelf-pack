!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ShelfPack={})}(this,(function(t){"use strict";var e=function(t,e,i,h,s,n,r,o){void 0===n&&(n=h),void 0===r&&(r=s),void 0===o&&(o=0),this.id=t,this.x=e,this.y=i,this.width=h,this.height=s,this.maxwidth=n,this.maxheight=r,this.refcount=o},i=function(){function t(t,e,i,h){void 0===h&&(h=0),this.y=t,this.width=e,this.height=i,this.x=h,this.free=e}return t.prototype.allocateBin=function(t,i,h){if(t>this.free||i>this.height)return null;var s=this.x;return this.x+=t,this.free-=t,new e(h,s,this.y,t,i,t,this.height)},t.prototype.resize=function(t){this.free+=t-this.width,this.width=t},t}(),h=function(){function t(t,e,i){void 0===t&&(t=64),void 0===e&&(e=64);var h=null!=i?i:{};this.autoResize=!!h.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0,this.width=t,this.height=e}return t.prototype.pack=function(t,e){void 0===e&&(e={inPlace:!1,shrinkAfterPack:!0});for(var i,h,s,n,r=t,o=[],f=0;f<r.length;f++)if(i=r[f].width,h=r[f].height,s=r[f].id,i&&h){if(!(n=this.packOne(i,h,s)))continue;e.inPlace&&(r[f].x=n.x,r[f].y=n.y,r[f].id=n.id),o.push(n)}return e.shrinkAfterPack&&this.shrink(),o},t.prototype.packOne=function(t,e,h){var s,n,r,o,f,a={freebin:-1,shelf:-1,waste:1/0},l=0;if("string"==typeof h||"number"==typeof h){if(s=this.getBin(h))return this.incrementReferenceCount(s),s;f=h}else f=++this.maxId;for(o=0;o<this.freebins.length;o++){if(e===(s=this.freebins[o]).maxheight&&t===s.maxwidth)return this.allocateFreeBin(o,t,e,f);e>s.maxheight||t>s.maxwidth||e<=s.maxheight&&t<=s.maxwidth&&(r=s.maxwidth*s.maxheight-t*e)<a.waste&&(a.waste=r,a.freebin=o)}for(o=0;o<this.shelves.length;o++)if(l+=(n=this.shelves[o]).height,!(t>n.free)){if(e===n.height)return this.allocShelf(o,t,e,f);e>n.height||e<n.height&&(r=(n.height-e)*t)<a.waste&&(a.freebin=-1,a.waste=r,a.shelf=o)}if(-1!==a.freebin)return this.allocateFreeBin(a.freebin,t,e,f);if(-1!==a.shelf)return this.allocShelf(a.shelf,t,e,f);if(e<=this.height-l&&t<=this.width)return n=new i(l,this.width,e),this.allocShelf(this.shelves.push(n)-1,t,e,f);if(this.autoResize){var u,c,d=void 0,p=void 0;return u=d=this.height,((c=p=this.width)<=u||t>c)&&(p=2*Math.max(t,c)),(u<c||e>u)&&(d=2*Math.max(e,u)),this.resize(p,d),this.packOne(t,e,f)}return null},t.prototype.allocateFreeBin=function(t,i,h,s){var n=this.freebins.splice(t,1)[0],r=new e(s,n.x,n.y,i,h,n.maxwidth,n.maxheight,0);return this.bins[s]=r,this.incrementReferenceCount(r),r},t.prototype.allocShelf=function(t,e,i,h){var s=this.shelves[t].allocateBin(e,i,h);if(null===s)throw new Error("Failed to allocate bin on shelf.");return this.bins[h]=s,this.incrementReferenceCount(s),s},t.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,e=0,i=0;i<this.shelves.length;i++){var h=this.shelves[i];e+=h.height,t=Math.max(h.width-h.free,t)}this.resize(t,e)}},t.prototype.getBin=function(t){return this.bins[t]},t.prototype.incrementReferenceCount=function(t){return 1==++t.refcount&&(this.stats[t.height]=1+(0|this.stats[t.height])),t.refcount},t.prototype.decrementReferenceCount=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.height]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},t.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},t.prototype.resize=function(t,e){this.width=t,this.height=e;for(var i=0;i<this.shelves.length;i++)this.shelves[i].resize(t);return!0},t}();t.Bin=e,t.Shelf=i,t.ShelfPack=h}));
//# sourceMappingURL=shelf-pack.min.js.map
